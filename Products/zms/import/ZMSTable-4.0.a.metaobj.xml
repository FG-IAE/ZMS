<?xml version="1.0" encoding="utf-8" ?>
<?zms version='ZMS4-4.0.0.dev.REV
'?>
<dictionary>
  <item key="key">ZMSTable</item>
  <item key="value" type="dictionary">
    <dictionary>
      <item key="__obj_attrs__" type="list">
        <list>
          <item type="dictionary">
            <dictionary>
              <item key="default"></item>
              <item key="id">caption</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">1</item>
              <item key="name">Caption</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">string</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="default">0</item>
              <item key="id">sortable</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name">Sortable</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">boolean</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="default">0</item>
              <item key="id">colgroup</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name">Colgroup</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">boolean</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[## Script (Python) "ZMSTable.titlealt"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: DC.Title.Alt
##
# --// BO titlealt //--

titlealt = zmscontext.attr('caption')
if titlealt:
    return titlealt
return zmscontext.display_type(zmscontext.REQUEST)

# --// EO titlealt //--
]]>
              </item>
              <item key="default"></item>
              <item key="id">titlealt</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name">DC.Title.Alt</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">py</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[<tal:block tal:define="textFormatDefault python:here.getConfProperty('ZMSTable.getTextFormatDefault',here.getTextFormatDefault())">
	<!-- ### Table(Type,Cols,Rows): INSERT ### -->
	<tal:block tal:condition="python:request.get('ZMS_INSERT')">
		<input type="hidden" name="redirect_self:int" value="1"/>
		<span class="d-none" id="fmName" tal:content="request/fmName"></span>
		<span class="d-none" id="textFormatDefault" tal:content="textFormatDefault"></span>
		<script>
		//<!--
		var fmName;
		var textFormatDefault;
		
		$(function() {
				fmName = $('#fmName').text();
				textFormatDefault = $("#textFormatDefault").text();
				$("form[name="+fmName+"]").submit( onZMSTableFormSubmit);
				
				$("[name=\x22type:int\x22]").on('change',function(){
					let sortableTr = $('#tr_sortable');
					if(this.value==3){
						sortableTr.hide();
					}else{
						sortableTr.show()
					}
				});
			});
		
		function onZMSTableFormSubmit() {
			var xml = '';
			var type = parseInt($("[name=\x22type:int\x22]").val());
			xml += '<'+'list>\n';
			for ( var y = 0; y < parseInt($('#rows').val()); y++) {
				xml += '<'+'item type="list"><list>\n';
				if ( y==0 && type == 2) {
					xml += '<'+'item type="dictionary"><'+'dictionary>\n';
					xml += '<'+'item key="colspan" type="int">'+parseInt($('#cols').val())+'<'+'/item>\n';
					xml += '<'+'item key="content"><'+'/item>\n';
					xml += '<'+'item key="format">'+textFormatDefault+'<'+'/item>\n';
					xml += '<'+'item key="tag">th<'+'/item>\n';
					xml += '<'+'/dictionary><'+'/item>\n';
				}
				else {
					for ( var x = 0; x < parseInt($('#cols').val()); x++) {
						xml += '<'+'item type="dictionary"><'+'dictionary>\n';
						if ( y==0 && x == 0 && type == 4) {
							xml += '<'+'item key="colspan" type="int">1<'+'/item>\n';
						}
						else {
							var tag = "td";
							if ( (type == 1 && y == 0) ||
								(type == 3 && x == 0) ||
								(type == 4 && (x == 0 || y == 0))) {
								tag = "th";
							}
							xml += '<'+'item key="colspan" type="int">1<'+'/item>\n';
							xml += '<'+'item key="content"><'+'/item>\n';
							xml += '<'+'item key="format">'+textFormatDefault+'<'+'/item>\n';
							xml += '<'+'item key="tag">'+tag+'<'+'/item>\n';
						}
						xml += '<'+'/dictionary><'+'/item>\n';
					}
				}
				xml += '<'+'/list><'+'/item>\n';
			}
			xml += '<'+'/list>\n';
			$("#table_table").val( xml);
			return true;
		}
		// -->
		</script>
	
		<div class="form-group row">
			<label class="col-sm-2 control-label mandatory"><span tal:content="structure python:here.getZMILangStr('ATTR_COLS')">Cols</span></label>
			<div class="col-sm-4">
				<tal:block tal:content="structure python:here.getTextInput(fmName=request['fmName'],elName='cols',value='3',size=2)"></tal:block>
			</div>
			<label class="col-sm-2 control-label mandatory"><span tal:content="structure python:here.getZMILangStr('ATTR_ROWS')">Rows</span></label>
			<div class="col-sm-4">
				<tal:block tal:content="structure python:here.getTextInput(fmName=request['fmName'],elName='rows',value='3',size=2)"></tal:block>
			</div>
		</div>
		
		<div class="form-group row">
			<label class="col-sm-2 control-label mandatory" tal:content="python:here.getZMILangStr('ATTR_TYPE')">the type-label</label>
			<div class="col-sm-10">
				<select class="form-control" name="type:int">
					<option value="1">Horizontal Header</option>
					<option value="3">Vertikal Header</option>
				</select>
				<small class="form-text text-muted" tal:content="python:here.getZMILangStr('MSG_ZMSTABLE_TYPE')"></small>
			</div>
		</div>
	</tal:block>

	<!-- ### Table(Type,Cols,Rows): EDIT ### -->
	<tal:block tal:condition="not:python:request.get('ZMS_INSERT')">
		<tal:block tal:define="zmscontext options/zmscontext;
					table_table python:zmscontext.attr('table');
					table_type python:zmscontext.attr('type');
					table_colgroup_cols python:zmscontext.attr('cols');
					table_cols python:len(table_table[-1]);
					table_rows python:len(table_table);
					table_widths python:zmscontext.attr('widths');">
			<!-- BO Customstyles (uzk) -->
			<style>
				td.ZMSTable-cell {
					padding: 0;
				}
				#table_cell_editor > thead > tr > th {
					background-color: #32475b;
					color: #fff;
				}
				#table_cell_editor > thead > tr > th, 
				#table_cell_editor > thead > tr > td {
					padding: 1.57143em 1.14286em 1.57143em 1.14286em;
					
				}
				#table_cell_editor tr th p:last-child, 
				#table_cell_editor tr td p:last-child {
					 margin-bottom: 0;
				}
				#table_cell_editor .table_cell_editable.current {
					background-color: rgba(0,123,255,.15);
					color: #212529;
				}
				table tr:nth-child(even) td {
					background-color: #e3e8ed;
				}
				#table_cell_editor > thead > tr:first-child td{
					background-color: #32475b;
					color: #fff;
				}
				.zmi-interface table th textarea.form-control{
					color:white;
				}
				<tal:block tal:condition="python:table_type == 3">
					#tr_sortable{
						display:none;
					}
					
					#table_cell_editor>tbody>tr:nth-child(odd) td {
						background-color: #e3e8ed;
					}
					#table_cell_editor>tbody>tr:nth-child(even) td {
						background-color: #FFFFFF
					}
					
					#table_cell_editor>tbody>tr>td:first-child{
						background-color: #32475b;;
					}
					#table_cell_editor tr#colgrouping td{
						background-color:#FFFFFF;
					}
				</tal:block>
			</style>
			<!-- EO Customstyles (uzk) -->
			
			<!--### Table-Cell Editor ###-->
			<tal:block tal:define="celltypes python:[['td','td'],['th','th']];custom python:'<div class=\042pull-left celltypes\042>%s</div>'%(here.zmi_input_select(name='tag',value='',lang_str=here.getZMILangStr('ATTR_FORMAT'),options=celltypes))">
				<div class="d-none ui-helper-overlay modal-backdrop in">&nbsp;</div>
				<div class="d-none">
					<div id="div_table_cell_editor">
						<tal:block tal:content="structure python:here.f_selectRichtext(ob=here,fmName=request['fmName'],elName='content_editor',cols=25,rows=10,value='',key='cell',enabled=True,lang=request['lang'],lang_str=here.getZMILangStr('ACTION_EDIT_CELL'),custom_str=custom,REQUEST=request,wrap='virtual',format='')"></tal:block>
			
						<div class="form-row">
							<div class="controls save">
								<button class="btn btn-primary" type="submit" tal:attributes="value python:here.getZMILangStr('BTN_CHANGE')" onclick="return table_cell_change();">
									<tal:block tal:content="python:here.getZMILangStr('BTN_CHANGE')">Change</tal:block>
								</button>
								<button class="btn btn-secondary" type="submit" tal:attributes="value python:here.getZMILangStr('BTN_CANCEL')" onclick="return table_cell_cancel();">
									<tal:block tal:content="python:here.getZMILangStr('BTN_CANCEL')">Cancel</tal:block>
								</button>
							</div>
						</div>
					</div>
				</div>
			</tal:block>

			<!-- ### Table-Cell Grid ###-->

			<span class="d-none" id="fmName" tal:content="request/fmName"></span>
			<span class="d-none" id="elName" tal:content="request/elName"></span>

			<span class="d-none" id="textFormatDefault" tal:content="textFormatDefault"></span>
			<tal:block tal:condition="python:request.get('richedit_fmt',None)"><span class="d-none" id="richedit_fmt" tal:content="python:request.get('richedit_fmt').getId()"></span></tal:block>
			<span class="d-none" id="table_type" tal:content="table_type"></span>
			<span class="d-none" id="table_cell_uid" tal:content="python:table_cols*table_rows"></span>
			<style>
				#table_cell_editor .btn {
					padding: 0 .3em;
				}
				.zmi.ZMSTable.properties .modal-backdrop.in {
					filter: alpha(opacity=30);
					opacity: .3;
				}
				.div_table_cell_editor_parent {
					position:absolute;
					background:#FEFEFE;
					z-index:9999;
					border-radius: 4px;
					box-shadow: 0 4px 16px #333;
				}
				#div_table_cell_editor {
					width:65em;
					margin:1em;
				}
				#table_cell_editor #colgrouping td {
					min-width:6em
				}
				.celltypes select {
					width:10em;
				}
				/* Compensate Preview Styles */
				#table_cell_editor table.ZMSTable {
					margin:0
				}
				#table_cell_editor table.ZMSTable td,
				#table_cell_editor table.ZMSTable th {
					border:0 !important;
					margin:0;
					padding:0;
				}
				#table_cell_editor table.ZMSTable th > div,
				#table_cell_editor table.ZMSTable td > div {
					padding:.5em;
				}
				#table_cell_editor table.ZMSTable [contenteditable]:focus {
					outline: 2px dotted #007bff;
					background-color:rgba(0, 123, 255, 0.05);
				}
				img.vbutton {
					border:1px solid #CCC;
					height:16px!important;
					width:8px!important;
					border-radius:3px;
				}
				img.hbutton {
					border:1px solid #CCC;
					height:8px!important;
					width:16px!important;
					border-radius:3px;
				}
				td .btn-group {
					width:80px;
				}
				.ZMSTable-cell {
					border:1px solid #CCC;
				}
				.ZMSTable-cell.top, 
				.ZMSTable-cell.right, 
				.ZMSTable-cell.bottom, 
				.ZMSTable-cell.left {
					border-top:2px solid #666;
				}
				.table_cell_editable.changed {
					background-color:#FFF;
				}
				.table_cell_editable.active {
					background-color:#FFC;
				}
				.table_cell_editable.new {
					background-color:#DFD;
				}
				.table_cell_editable.moved {
					background-color:#FFF;
				}
				/* shift url select modal win to top */
				.modal {
					z-index:10000;
				}
			</style>
			
			<script>
			// <!--
				var fmName;
				var elName;
				var textFormatDefault;
				var richedit_fmt;
				var table_type;
				var table_cell_uid;
				var table_cell_id;
				var table_cell_offs;
				
				$(function() {
						fmName = $('#fmName').text();
						elName = $('#elName').text();
						textFormatDefault = $("#textFormatDefault").text();
						richedit_fmt = $('#richedit_fmt').text();
						table_type = parseInt($('#table_type').text());
						table_cell_uid = $('#table_cell_uid').text();
						table_cell_id = '';
						table_cell_offs = 2;
						$('form[name='+fmName+']').submit( onZMSTableFormSubmit);
						table_cell_init();
					});
				
				function onZMSTableFormSubmit() {
					var xml = '';
					xml += '<'+'list>\n';
					var el_tbody = $($("#table_cell_editor").children()[0]);
					var el_trs = el_tbody.children().filter(":gt(0)");
					for ( var i=0; i < el_trs.length; i++) {
						xml += '<'+'item type="list"><'+'list>\n';
						//changed by uzk
						var el_tds = $(el_trs[i]).children();
						//var el_tds = $(el_trs[i]).children().filter(":gt(0)").filter(":not(:last)");
						for ( var j=0; j < el_tds.length; j++) {
							xml += '<'+'item type="dictionary"><'+'dictionary>\n';
							xml += '<'+'item key="colspan" type="int">'+1+'<'+'/item>\n';
	
							var el_inputs = $("textarea,input",el_tds[j]);
							for ( var k=0; k < el_inputs.length; k++) {
								var key = el_inputs[k].id.substr(0,el_inputs[k].id.indexOf("_"));
								xml += '<'+'item key="'+key+'"><'+'![CDATA'+'['+$(el_inputs[k]).val()+']'+']><'+'/item>\n';
							}
							xml += '<'+'/dictionary><'+'/item>\n';
						}
						xml += '<'+'/list><'+'/item>\n';
					}
					xml += '<'+'/list>\n';
	
					$("#table_table").val( xml);
					xml = '';
					xml += '<'+'list>\n';
					var el_trs = el_tbody.children().filter(":eq(0)");
					for ( var i=0; i < el_trs.length; i++) {
						var el_inputs = $("input:text",el_trs[i]);
						for ( var j = 0; j < el_inputs.length; j++) {
							xml += '<'+'item type="string">'+$(el_inputs[j]).val()
							+'<'+'/item>\n';
						}
					}
					xml += '<'+'/list>\n';
					
					$("#table_colgroup_cols").val( xml);
					return true;
				}
				
				
				function table_cell_edit(el_td) {
					var el = $('textarea',el_td);
					var el_name = el.attr('name');
					table_cell_id = el_name.substr(el_name.indexOf('_')+1);
					// Set cell background.
					el_td.addClass("active");
					// Apply values.
					$('#zmiRichtextEditor'+elName).hide();
					$('#zmiStandardEditor'+elName).show();
					$('#content_editor').val($('#content_'+ table_cell_id).val());
					$('select[name="tag"]').val($('#tag_'+ table_cell_id).val());
					$('#format').val($('#format_'+ table_cell_id).val());
					if (typeof richedit_fmt != 'undefined') {
						zmiRichtextSyncDataToView(elName);
						if ( $('#format').val()==richedit_fmt) {
							$('#zmiRichtextEditor'+'content_editor').show();
							$('#zmiStandardEditor'+'content_editor').hide();
							zmiStandardOnSubmitEventHandler();
						}
					}
					// Open cell editor.
					var offset = $(el_td).offset();
					$('.ui-helper-overlay').removeClass('d-none');
					//$('#div_table_cell_editor').parent().addClass('div_table_cell_editor_parent').css({left:offset.left,top:offset.top}).removeClass('d-none');
					let cell_editor = $('#div_table_cell_editor');
					let left = cell_editor.width() < window.innerWidth ? (window.innerWidth - cell_editor.width())/2  : 0; 
					let top =  window.innerHeight > 400 ? (window.innerHeight - 400)/2 : 0;
					$('#div_table_cell_editor').parent().addClass('div_table_cell_editor_parent').css({left:left, top:top}).removeClass('d-none');
					$('#zmiRichtextEditor'+'content_editor').height(300);
					zmiRichtextResize('content_editor');
				}
				
				function table_cell_change() {
					if (typeof richedit_fmt != 'undefined') {
						if ( $('#format').val()==richedit_fmt) {
							zmiRichtextOnSubmitEventHandler();
							$('#input_'+ table_cell_id).hide();
							$('#preview_'+ table_cell_id).show();
						}
						else {
							$('#input_'+ table_cell_id).show();
							$('#preview_'+ table_cell_id).hide();
						}
					}
					$('#format_'+ table_cell_id).val($('#format').val());
					$('#tag_'+ table_cell_id).val($('select[name="tag"]').val());
					$('#content_'+ table_cell_id).val($('#content_editor').val());
					$('#preview_'+ table_cell_id).html($('#content_editor').val());
					return table_cell_cancel();
				}
				
				function table_cell_cancel(event) {
					// Reset cell background.
					var el_td = $("td.active");
					el_td.removeClass("active");
					// Close cell editor.
					if (!event) {
						/*
						$('#div_table_cell_editor').modal('hide');
						*/
						$('.ui-helper-overlay').addClass('d-none');
						$('#div_table_cell_editor').parent().addClass('d-none');
					}
					return false;
				}
				
				
				function table_cell_init() {
					$("form[name="+fmName+"] input[type=hidden]+textarea").change( function () { $(this).parents(".table_cell_editable").addClass('changed').removeClass('changed',1000);});
					$("form[name="+fmName+"] .table_cell_editable").dblclick( function () { table_cell_edit($(this));});
					$('div[id^=preview_]')
						.attr('contenteditable','').keyup(onKeyUpZMSTableDivContenteditable).blur(onKeyUpZMSTableDivContenteditable).on('contextmenu',function(){onKeyUpZMSTableDivContenteditable});
				}
				
				function actionBtnClick(el, fct) {
					var x = 0;
					var $td = $(el).closest("td");
					while ( $td.prev().length > 0) {
						x++;
						$td = $td.prev();
					}
					var y = 0;
					var $tr = $($td.parent("tr"));
					while ( $tr.prev().length > 0) {
						y++;
						$tr = $tr.prev();
					}
					var $tbody = $(el).closest("tbody");
					//////////////////////////////////////////////////////////////////////////////
					/// DELETE
					//////////////////////////////////////////////////////////////////////////////
					if (fct.indexOf('delete') == 0) {
						if (confirm(getZMILangStr('MSG_CONFIRM_DELOBJ'))) {
							if (fct.indexOf('delete_col') == 0) {
								var $trs = $tbody.children();
								for ( var i = 0; i < $trs.length; i++) {
									if ( i == table_cell_offs && table_type == 2) {
										var $td = $($trs[i]).children().filter(":eq("+table_cell_offs+")");
										$td.prop("colspan",parseInt($td.prop("colspan"))-1);
									}
									else {
										var $td = $($trs[i]).children().filter(":eq("+x+")");
										$td.remove();
									}
								}
								$('#cols').val( parseInt($('#cols').val())-1);
							}
							else if (fct.indexOf('delete_row') == 0) {
								var $tr = $tbody.children().filter(":eq("+y+")");
								$tr.remove();
								$('#rows').val( parseInt($('#rows').val())-1);
							}
						}
					}
					//////////////////////////////////////////////////////////////////////////////
					/// INSERT
					//////////////////////////////////////////////////////////////////////////////
					else if (fct.indexOf('insert_col') == 0) {
						var $trs = $tbody.children();
						for ( var i = 0; i < $trs.length; i++) {
							if ( i == table_cell_offs && table_type == 2) {
								var $td = $($trs[i]).children().filter(":eq("+table_cell_offs+")");
								$td.attr("colspan",parseInt($td.attr("colspan"))+1);
							}
							else {
								var $tds = $($trs[i]).children();
								var $td = $tds.filter(":eq("+x+")");
								var new_td = insertCell($tds[$tds.length-2]);
								if(fct.indexOf('insert_col_left') == 0){
									new_td.insertBefore( $td);
								}else{
									new_td.insertAfter( $td);
								}
								
							}
						}
						$('#cols').val( parseInt($('#cols').val())+1);
						table_cell_init();
					}
					else if (fct.indexOf('insert_row') == 0) {
						var $trs = $tbody.children();
						var $tr = $trs.filter(":eq("+y+")");
						var new_tr = insertCell($trs[$trs.length-2]);
						if(fct.indexOf('insert_row_above') == 0) {
							new_tr.insertBefore( $tr);
						}else{
							new_tr.insertAfter( $tr);
						}
					
						$('#rows').val( parseInt($('#rows').val())-1);
						table_cell_init();
					}
					//////////////////////////////////////////////////////////////////////////////
					/// MOVE
					//////////////////////////////////////////////////////////////////////////////
					else if (fct.indexOf('move_col') == 0) {
						var source_x = x;
						var target_x = x;
						if (fct == 'move_col_left') {
							target_x = target_x - 1;
						}
						else {
							target_x = target_x + 1;
						}
						var $trs = $tbody.children().filter(":gt(0)");
						for ( var i = 0; i < $trs.length; i++) {
							var source_td = $($trs[i]).children().filter(":eq("+source_x+")");
							var target_td = $($trs[i]).children().filter(":eq("+target_x+")");
							moveCell(source_td, target_td);
						}
					}
					else if (fct.indexOf('move_row') == 0) {
						var source_y = y;
						var target_y = y;
						if (fct == 'move_row_up') {
							target_y = target_y - 1;
						}
						else {
							target_y = target_y + 1;
						}
						var source_tr = $tbody.children().filter(":eq("+source_y+")");
						var target_tr = $tbody.children().filter(":eq("+target_y+")");
						moveCell(source_tr, target_tr);
					}
					else {
						var par = Math.max(x,y)-table_cell_offs;
						var fm = document.forms[fmName];
						fm.elements['function'].value = fct;
						fm.elements['param'].value = par;
						fm.submit();
					}
				}
				
				function insertCell(source) {
					var $clone = $(source).clone();
					$("table.ZMSTable th, table.ZMSTable td",$clone).each(function() {
							// Remove table with inline-links (if exists).
							$("table",this).remove();
							$("textarea,input",this).each(function() {
									var key = this.id.substr(0,this.id.indexOf("_"));
									$(this).attr( "id", key+"_" + table_cell_uid);
									$(this).attr( "name", key+"_" + table_cell_uid);
									if ( key.indexOf("format") == 0) {
										$(this).val( textFormatDefault);
									}
									else if ( key.indexOf("content") == 0) {
										$(this).val( "").css( 'border', '2px solid #00FF00');
									}
								});
							$('div[id^="preview"]',this).each(function() {
									$(this).attr("id","preview_"+table_cell_uid)
										.html('')
										.attr('contenteditable','')
										.keyup(onKeyUpZMSTableDivContenteditable).blur(onKeyUpZMSTableDivContenteditable);
								});
							$(this).addClass('new').removeClass('new',1000);
							table_cell_uid++;
						});
					return $clone;
				}
				
				function moveCell(source, target) {
					var source_inp = $("textarea,input",source);
					var target_inp = $("textarea,input",target);
					for ( var j = 0; j < source_inp.length; j++) {
						var v = $(source_inp[j]).val();
						$(source_inp[j]).val( $(target_inp[j]).val());
						$(target_inp[j]).val( v);
					}
					var source_preview = $("div[id^=preview]",source);
					var target_preview = $("div[id^=preview]",target);
					for ( var j = 0; j < source_preview.length; j++) {
						var v = $(source_preview[j]).html();
						$(source_preview[j]).html( $(target_preview[j]).html());
						$(target_preview[j]).html( v);
					}
					$("td.table_cell_editable",target).addClass("moved").removeClass("moved",1000);
				}
				
				function onKeyUpZMSTableDivContenteditable() {
					var $textarea = $("textarea",$(this).prev());
					$textarea.val($(this).html());
				}
			// -->
			</script>

			<!-- BO Dropdown (uzk) -->
			<div class="dropdown-menu dropdown-menu-sm" id="context-menu">
				<a class="dropdown-item move_col_left" href="#"><i class="fas fa-caret-left"></i>Spalte nach Link verschieben</a>
				<a class="dropdown-item move_col_right" href="#"><i class="fas fa-caret-right"></i>Spalte nach Rechts verschieben</a>
				<a class="dropdown-item delete_col" href="#"><i class="fas fa-trash"></i>Ganze Spalte l&ouml;schen</a>
				<a class="dropdown-item insert_col_left" href="#"><i class="far fa-plus-square"></i>Neue Spalte links einf&uuml;gen</a>
				<a class="dropdown-item insert_col_right" href="#"><i class="far fa-plus-square"></i>Neue Spalte rechts einf&uuml;gen</a>
				<div class="dropdown-divider"></div>
				<a class="dropdown-item move_row_up" href="#"><i class="fas fa-caret-up"></i>Zeile nach oben verschieben</a>
				<a class="dropdown-item move_row_down" href="#"><i class="fas fa-caret-down"></i>Zeile nach unten verschieben</a>
				
				<a class="dropdown-item delete_row" href="#"><i class="fas fa-trash"></i>Ganze Zeile l&ouml;schen</a>
				<a class="dropdown-item insert_row_above" href="#"><i class="far fa-plus-square"></i>Neue Zeile oberhalb einf&uuml;gen</a>
				<a class="dropdown-item insert_row_below" href="#"><i class="far fa-plus-square"></i>Neue Zeile unterhalb einf&uuml;gen</a>
			</div>
			<style>
				.dropdown-menu{ position:absolute; }
				.div_table_cell_editor_parent{ position:fixed; }
				.dropdown-item.disabled, .dropdown-item:disabled { cursor: no-drop;}
			</style>
			<script>
			// <!--
				$(function () {
					$('table.table *, table.table *').on('contextmenu', function (e) {
						$('table#table_cell_editor .table_cell_editable.current').removeClass('current');
						let contextMenu = $("#context-menu");
						var target = e.target;
						let card = contextMenu.closest('.card');
						var top = e.pageY - card.position().top;
						var left = e.pageX - card.position().left;
						
						var height =$("#context-menu").height();
						var bottom = top + height;
						var width = $("#context-menu").width();
						var right = left + width;
						
						var doc_bottom =  (window.pageYOffset + window.innerHeight);
						var doc_right = (window.pageXOffset + window.innerWidth);
						
						if(bottom > doc_bottom){
							top = top - height;
						}
						if( right > doc_right){
							left = left - width;
						}

						$("#context-menu").css({
							display: "block",
							top: top,
							left: left
						}).addClass("show");
						
					  
						if($(target).hasClass('ZMSTable-cell')){
							target = $('.table_cell_editable', target).first();
						}
						
						let contextmenu = $('#context-menu');
						let selector = '.table_cell_edit';
						let btn = $(selector, contextmenu);
						let table_cell = $($(target).closest('.table_cell_editable'));
						table_cell.addClass('current');
						let actionlist = ['move_col_left', 'move_col_right', 'move_row_down', 'move_row_up', 'insert_row_above', 'insert_row_below', 'delete_row', 'insert_col_left', 'insert_col_right', 'delete_col'];
						for (let action of actionlist) {
							let selector = '.' + action;
							let btn = $('.' + action, contextmenu);
							let actionAvailable = true;
							
							if(action == 'move_row_up' && (table_cell.closest('tr#table_row_0').length > 0 || (table_type == 1 && table_cell.closest('tr#table_row_1').length > 0)) ){
								actionAvailable = false;
							}else if(action == 'move_col_left' && (table_cell.closest('.ZMSTable-cell').prev().length == 0 || table_type == 3 && table_cell.closest('.ZMSTable-cell').prevAll('.ZMSTable-cell').length == 1)){
								actionAvailable = false;   
							}else if(action == 'move_col_right' && table_cell.closest('.ZMSTable-cell').next().length == 0){
								actionAvailable = false;
							}else if(action == 'move_row_down' && table_cell.closest('.ZMSTable-cell').closest('tr').next().length==0){
								actionAvailable = false;
							}else if(table_cell.prop("tagName") == "TH") {
								if(table_type == 1 && ['move_row_down','insert_row_above','delete_row'].includes(action)){
									actionAvailable = false; 
								}else if(table_type == 3 && ['move_col_left','move_col_right','insert_col_left','delete_col'].includes(action)){
									actionAvailable = false;
								}
							}
							
							if(actionAvailable){
								btn.show();
								btn.off('click');
								btn.on('click', function (event) {
									event.preventDefault();
									actionBtnClick($(target).closest('.ZMSTable'), action);
									$('table#table_cell_editor .table_cell_editable.current').removeClass('current');
									contextmenu.removeClass("show").hide();
								});
							}else{
								btn.hide();
							}
						}

						return false; //blocks default Webbrowser right click menu
					})

					$(document).on("click ", function (event) {
						$('table#table_cell_editor .table_cell_editable.current').removeClass('current');
						$('#context-menu').removeClass("show").hide();
					});
				});
			//-->
			</script>
			<!-- EO Dropdown (uzk) -->

			<table id="table_cell_editor" class="table" cellspacing="0" cellpadding="0" border="0">
				<tr id="colgrouping">
					<tal:block tal:repeat="col_index python:range(table_cols)">
						<td align="center" tal:attributes="style python:'width:%s'%([ 'initial', '%s%%'%((table_colgroup_cols+[''])[min(col_index,len(table_colgroup_cols))]) ][zmscontext.attr('colgroup')] )">
							<tal:block tal:condition="python:zmscontext.attr('colgroup')">
								<input class="form-control form-control-sm" type="text" size="3"
									style="display:inline;width:4em;"
									onchange="$(this).parent().css('width',$(this).val()+'%')"
									tal:attributes="name python:'col%i'%col_index;
										value python:(table_colgroup_cols+[''])[min(col_index,len(table_colgroup_cols))];
										title python: 'Calculated Average-Width = %s%%'%(table_widths[col_index])" />
								&#37;
							</tal:block>
						</td>
					</tal:block>
				</tr>
				<tr tal:repeat="row_index python:range(table_rows)" tal:attributes="id python:'table_row_%i'%row_index">
					<tal:block tal:repeat="col_index python:range(len(table_table[row_index]))">
						<tal:block tal:define="global 
								cell python:table_table[row_index][col_index];
								pattern python:'%3Cdtml-var%20\042 getlinkurl\\((.*?),request\\)\042=\042\042>\042&gt\073';
								replacement python:'<dtml-var \042getLinkUrl(\\1,REQUEST)\042>\042>';
								cell_content python:here.re_sub(pattern,replacement,cell.get('content',''));
								cell_format python:cell.get('format',textFormatDefault);
								richedit_preview python:int(request.get('richedit_fmt') is not None and cell_format==request.get('richedit_fmt').getId())">
						
							<td class="ZMSTable-cell" tal:attributes="colspan cell/colspan">
								<div class="ZMSTable">
									<table style="width:100%" class="ZMSTable">
									<tr>
										<tal:block tal:content="structure python:'<%s title=\042onDblClick: %s\042 class=\042table_cell_editable\042>'%(['td',cell['tag']][cell['tag']!=''],here.getZMILangStr('ACTION_EDIT_CELL'))">start-tag</tal:block>
										<input type="hidden" tal:attributes="id python:'tag_%i_%i'%(col_index,row_index); value cell/tag" />
										<input type="hidden" tal:attributes="id python:'format_%i_%i'%(col_index,row_index); value cell_format" />
										<div tal:attributes="id python:'input_%i_%i'%(col_index,row_index); class python:['','d-none'][richedit_preview]">
											<tal:block tal:content="structure python:here.getTextArea(request.get('fmName',''),'content_%i_%i'%(col_index,row_index),10,1,value=cell_content,enabled=True)"></tal:block>
										</div>
										<div tal:attributes="id python:'preview_%i_%i'%(col_index,row_index);class python:['d-none',''][richedit_preview]"
											><tal:block tal:condition="cell/content" tal:content="structure cell_content">the cell-content</tal:block
											><tal:block tal:condition="not:cell/content"></tal:block
										></div>
										<tal:block tal:content="structure python:'</%s><!-- .table_cell_editable -->'%cell['tag']">end-tag</tal:block>
									</tr>
									</table>
								</div>
							</td>
							
						</tal:block>
					</tal:block>
				</tr>
			</table>
			<div class="form-group row">
				<div class="col-sm-12">
					<small class="form-text text-muted mb-3"><i class="fas fa-info-circle"></i> 
						Hinweise zur Bearbeitung: 
						Via Klick auf eine Tabellen-Zelle kann deren Inhalt bearbeitet werden. 
						Mit Doppelklick startet der WYSIWYG-Editor f&uuml;r den Zell-Inhalt. 
						Einf&uuml;gen, Verschieben oder L&ouml;schen von Zeilen bzw. Spalten per Rechtsklick-Kontextmen&uuml;.
					</small>
				</div>
			</div>		
			<input type="hidden" id="cols" tal:attributes="value table_cols" />
			<input type="hidden" id="rows" tal:attributes="value table_rows" />

		</tal:block>
	</tal:block>

	<input type="hidden" id="table_table" tal:attributes="name python:'table_%s'%request['lang']" value="<list></list>"/>
	<input type="hidden" id="table_colgroup_cols" tal:attributes="name python:'cols_%s'%request['lang']" value="<list></list>"/>
	<tal:block tal:define="global dummy0 python:request.set('ZMS_HIDE_ELEMENTS',request.get('ZMS_HIDE_ELEMENTS',[])+['type','table','colgroup','cols','sortable'])"></tal:block>

</tal:block>]]>
              </item>
              <item key="default"></item>
              <item key="id">interface0</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name">interface0</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">interface</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="default"></item>
              <item key="id">type</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">1</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name">Type</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">int</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="default"></item>
              <item key="id">table</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">1</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">1</item>
              <item key="name">Table</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">list</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="default"></item>
              <item key="id">cols</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">1</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">1</item>
              <item key="name">Cols</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">list</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><data encoding="base64" content_type="application/javascript" filename="jquery.tablesorter.min.js" type="file"><![CDATA[KGZ1bmN0aW9uKCQpeyQuZXh0ZW5kKHt0YWJsZXNvcnRlcjpuZXcgZnVuY3Rpb24oKXt2YXIgcGFyc2Vycz1bXSx3aWRnZXRzPVtdO3RoaXMuZGVmYXVsdHM9e2Nzc0hlYWRlcjoiaGVhZGVyIixjc3NBc2M6ImhlYWRlclNvcnRVcCIsY3NzRGVzYzoiaGVhZGVyU29ydERvd24iLGNzc0NoaWxkUm93OiJleHBhbmQtY2hpbGQiLHNvcnRJbml0aWFsT3JkZXI6ImFzYyIsc29ydE11bHRpU29ydEtleToic2hpZnRLZXkiLHNvcnRGb3JjZTpudWxsLHNvcnRBcHBlbmQ6bnVsbCxzb3J0TG9jYWxlQ29tcGFyZTp0cnVlLHRleHRFeHRyYWN0aW9uOiJzaW1wbGUiLHBhcnNlcnM6e30sd2lkZ2V0czpbXSx3aWRnZXRaZWJyYTp7Y3NzOlsiZXZlbiIsIm9kZCJdfSxoZWFkZXJzOnt9LHdpZHRoRml4ZWQ6ZmFsc2UsY2FuY2VsU2VsZWN0aW9uOnRydWUsc29ydExpc3Q6W10saGVhZGVyTGlzdDpbXSxkYXRlRm9ybWF0OiJ1cyIsZGVjaW1hbDonL1wufFwsL2cnLG9uUmVuZGVySGVhZGVyOm51bGwsc2VsZWN0b3JIZWFkZXJzOid0aGVhZCB0aCcsZGVidWc6ZmFsc2V9O2Z1bmN0aW9uIGJlbmNobWFyayhzLGQpe2xvZyhzKyIsIisobmV3IERhdGUoKS5nZXRUaW1lKCktZC5nZXRUaW1lKCkpKyJtcyIpO310aGlzLmJlbmNobWFyaz1iZW5jaG1hcms7ZnVuY3Rpb24gbG9nKHMpe2lmKHR5cGVvZiBjb25zb2xlIT0idW5kZWZpbmVkIiYmdHlwZW9mIGNvbnNvbGUuZGVidWchPSJ1bmRlZmluZWQiKXtjb25zb2xlLmxvZyhzKTt9ZWxzZXthbGVydChzKTt9fWZ1bmN0aW9uIGJ1aWxkUGFyc2VyQ2FjaGUodGFibGUsJGhlYWRlcnMpe2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7dmFyIHBhcnNlcnNEZWJ1Zz0iIjt9aWYodGFibGUudEJvZGllcy5sZW5ndGg9PTApcmV0dXJuO3ZhciByb3dzPXRhYmxlLnRCb2RpZXNbMF0ucm93cztpZihyb3dzWzBdKXt2YXIgbGlzdD1bXSxjZWxscz1yb3dzWzBdLmNlbGxzLGw9Y2VsbHMubGVuZ3RoO2Zvcih2YXIgaT0wO2k8bDtpKyspe3ZhciBwPWZhbHNlO2lmKCQubWV0YWRhdGEmJigkKCRoZWFkZXJzW2ldKS5tZXRhZGF0YSgpJiYkKCRoZWFkZXJzW2ldKS5tZXRhZGF0YSgpLnNvcnRlcikpe3A9Z2V0UGFyc2VyQnlJZCgkKCRoZWFkZXJzW2ldKS5tZXRhZGF0YSgpLnNvcnRlcik7fWVsc2UgaWYoKHRhYmxlLmNvbmZpZy5oZWFkZXJzW2ldJiZ0YWJsZS5jb25maWcuaGVhZGVyc1tpXS5zb3J0ZXIpKXtwPWdldFBhcnNlckJ5SWQodGFibGUuY29uZmlnLmhlYWRlcnNbaV0uc29ydGVyKTt9aWYoIXApe3A9ZGV0ZWN0UGFyc2VyRm9yQ29sdW1uKHRhYmxlLHJvd3MsLTEsaSk7fWlmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7cGFyc2Vyc0RlYnVnKz0iY29sdW1uOiIraSsiIHBhcnNlcjoiK3AuaWQrIlxuIjt9bGlzdC5wdXNoKHApO319aWYodGFibGUuY29uZmlnLmRlYnVnKXtsb2cocGFyc2Vyc0RlYnVnKTt9cmV0dXJuIGxpc3Q7fTtmdW5jdGlvbiBkZXRlY3RQYXJzZXJGb3JDb2x1bW4odGFibGUscm93cyxyb3dJbmRleCxjZWxsSW5kZXgpe3ZhciBsPXBhcnNlcnMubGVuZ3RoLG5vZGU9ZmFsc2Usbm9kZVZhbHVlPWZhbHNlLGtlZXBMb29raW5nPXRydWU7d2hpbGUobm9kZVZhbHVlPT0nJyYma2VlcExvb2tpbmcpe3Jvd0luZGV4Kys7aWYocm93c1tyb3dJbmRleF0pe25vZGU9Z2V0Tm9kZUZyb21Sb3dBbmRDZWxsSW5kZXgocm93cyxyb3dJbmRleCxjZWxsSW5kZXgpO25vZGVWYWx1ZT10cmltQW5kR2V0Tm9kZVRleHQodGFibGUuY29uZmlnLG5vZGUpO2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7bG9nKCdDaGVja2luZyBpZiB2YWx1ZSB3YXMgZW1wdHkgb24gcm93Oicrcm93SW5kZXgpO319ZWxzZXtrZWVwTG9va2luZz1mYWxzZTt9fWZvcih2YXIgaT0xO2k8bDtpKyspe2lmKHBhcnNlcnNbaV0uaXMobm9kZVZhbHVlLHRhYmxlLG5vZGUpKXtyZXR1cm4gcGFyc2Vyc1tpXTt9fXJldHVybiBwYXJzZXJzWzBdO31mdW5jdGlvbiBnZXROb2RlRnJvbVJvd0FuZENlbGxJbmRleChyb3dzLHJvd0luZGV4LGNlbGxJbmRleCl7cmV0dXJuIHJvd3Nbcm93SW5kZXhdLmNlbGxzW2NlbGxJbmRleF07fWZ1bmN0aW9uIHRyaW1BbmRHZXROb2RlVGV4dChjb25maWcsbm9kZSl7cmV0dXJuICQudHJpbShnZXRFbGVtZW50VGV4dChjb25maWcsbm9kZSkpO31mdW5jdGlvbiBnZXRQYXJzZXJCeUlkKG5hbWUpe3ZhciBsPXBhcnNlcnMubGVuZ3RoO2Zvcih2YXIgaT0wO2k8bDtpKyspe2lmKHBhcnNlcnNbaV0uaWQudG9Mb3dlckNhc2UoKT09bmFtZS50b0xvd2VyQ2FzZSgpKXtyZXR1cm4gcGFyc2Vyc1tpXTt9fXJldHVybiBmYWxzZTt9ZnVuY3Rpb24gYnVpbGRDYWNoZSh0YWJsZSl7aWYodGFibGUuY29uZmlnLmRlYnVnKXt2YXIgY2FjaGVUaW1lPW5ldyBEYXRlKCk7fXZhciB0b3RhbFJvd3M9KHRhYmxlLnRCb2RpZXNbMF0mJnRhYmxlLnRCb2RpZXNbMF0ucm93cy5sZW5ndGgpfHwwLHRvdGFsQ2VsbHM9KHRhYmxlLnRCb2RpZXNbMF0ucm93c1swXSYmdGFibGUudEJvZGllc1swXS5yb3dzWzBdLmNlbGxzLmxlbmd0aCl8fDAscGFyc2Vycz10YWJsZS5jb25maWcucGFyc2VycyxjYWNoZT17cm93OltdLG5vcm1hbGl6ZWQ6W119O2Zvcih2YXIgaT0wO2k8dG90YWxSb3dzOysraSl7dmFyIGM9JCh0YWJsZS50Qm9kaWVzWzBdLnJvd3NbaV0pLGNvbHM9W107aWYoYy5oYXNDbGFzcyh0YWJsZS5jb25maWcuY3NzQ2hpbGRSb3cpKXtjYWNoZS5yb3dbY2FjaGUucm93Lmxlbmd0aC0xXT1jYWNoZS5yb3dbY2FjaGUucm93Lmxlbmd0aC0xXS5hZGQoYyk7Y29udGludWU7fWNhY2hlLnJvdy5wdXNoKGMpO2Zvcih2YXIgaj0wO2o8dG90YWxDZWxsczsrK2ope2NvbHMucHVzaChwYXJzZXJzW2pdLmZvcm1hdChnZXRFbGVtZW50VGV4dCh0YWJsZS5jb25maWcsY1swXS5jZWxsc1tqXSksdGFibGUsY1swXS5jZWxsc1tqXSkpO31jb2xzLnB1c2goY2FjaGUubm9ybWFsaXplZC5sZW5ndGgpO2NhY2hlLm5vcm1hbGl6ZWQucHVzaChjb2xzKTtjb2xzPW51bGw7fTtpZih0YWJsZS5jb25maWcuZGVidWcpe2JlbmNobWFyaygiQnVpbGRpbmcgY2FjaGUgZm9yICIrdG90YWxSb3dzKyIgcm93czoiLGNhY2hlVGltZSk7fXJldHVybiBjYWNoZTt9O2Z1bmN0aW9uIGdldEVsZW1lbnRUZXh0KGNvbmZpZyxub2RlKXt2YXIgdGV4dD0iIjtpZighbm9kZSlyZXR1cm4iIjtpZighY29uZmlnLnN1cHBvcnRzVGV4dENvbnRlbnQpY29uZmlnLnN1cHBvcnRzVGV4dENvbnRlbnQ9bm9kZS50ZXh0Q29udGVudHx8ZmFsc2U7aWYoY29uZmlnLnRleHRFeHRyYWN0aW9uPT0ic2ltcGxlIil7aWYoY29uZmlnLnN1cHBvcnRzVGV4dENvbnRlbnQpe3RleHQ9bm9kZS50ZXh0Q29udGVudDt9ZWxzZXtpZihub2RlLmNoaWxkTm9kZXNbMF0mJm5vZGUuY2hpbGROb2Rlc1swXS5oYXNDaGlsZE5vZGVzKCkpe3RleHQ9bm9kZS5jaGlsZE5vZGVzWzBdLmlubmVySFRNTDt9ZWxzZXt0ZXh0PW5vZGUuaW5uZXJIVE1MO319fWVsc2V7aWYodHlwZW9mKGNvbmZpZy50ZXh0RXh0cmFjdGlvbik9PSJmdW5jdGlvbiIpe3RleHQ9Y29uZmlnLnRleHRFeHRyYWN0aW9uKG5vZGUpO31lbHNle3RleHQ9JChub2RlKS50ZXh0KCk7fX1yZXR1cm4gdGV4dDt9ZnVuY3Rpb24gYXBwZW5kVG9UYWJsZSh0YWJsZSxjYWNoZSl7aWYodGFibGUuY29uZmlnLmRlYnVnKXt2YXIgYXBwZW5kVGltZT1uZXcgRGF0ZSgpfXZhciBjPWNhY2hlLHI9Yy5yb3csbj1jLm5vcm1hbGl6ZWQsdG90YWxSb3dzPW4ubGVuZ3RoLGNoZWNrQ2VsbD0oblswXS5sZW5ndGgtMSksdGFibGVCb2R5PSQodGFibGUudEJvZGllc1swXSkscm93cz1bXTtmb3IodmFyIGk9MDtpPHRvdGFsUm93cztpKyspe3ZhciBwb3M9bltpXVtjaGVja0NlbGxdO3Jvd3MucHVzaChyW3Bvc10pO2lmKCF0YWJsZS5jb25maWcuYXBwZW5kZXIpe3ZhciBsPXJbcG9zXS5sZW5ndGg7Zm9yKHZhciBqPTA7ajxsO2orKyl7dGFibGVCb2R5WzBdLmFwcGVuZENoaWxkKHJbcG9zXVtqXSk7fX19aWYodGFibGUuY29uZmlnLmFwcGVuZGVyKXt0YWJsZS5jb25maWcuYXBwZW5kZXIodGFibGUscm93cyk7fXJvd3M9bnVsbDtpZih0YWJsZS5jb25maWcuZGVidWcpe2JlbmNobWFyaygiUmVidWlsdCB0YWJsZToiLGFwcGVuZFRpbWUpO31hcHBseVdpZGdldCh0YWJsZSk7c2V0VGltZW91dChmdW5jdGlvbigpeyQodGFibGUpLnRyaWdnZXIoInNvcnRFbmQiKTt9LDApO307ZnVuY3Rpb24gYnVpbGRIZWFkZXJzKHRhYmxlKXtpZih0YWJsZS5jb25maWcuZGVidWcpe3ZhciB0aW1lPW5ldyBEYXRlKCk7fXZhciBtZXRhPSgkLm1ldGFkYXRhKT90cnVlOmZhbHNlO3ZhciBoZWFkZXJfaW5kZXg9Y29tcHV0ZVRhYmxlSGVhZGVyQ2VsbEluZGV4ZXModGFibGUpOyR0YWJsZUhlYWRlcnM9JCh0YWJsZS5jb25maWcuc2VsZWN0b3JIZWFkZXJzLHRhYmxlKS5lYWNoKGZ1bmN0aW9uKGluZGV4KXt0aGlzLmNvbHVtbj1oZWFkZXJfaW5kZXhbdGhpcy5wYXJlbnROb2RlLnJvd0luZGV4KyItIit0aGlzLmNlbGxJbmRleF07dGhpcy5vcmRlcj1mb3JtYXRTb3J0aW5nT3JkZXIodGFibGUuY29uZmlnLnNvcnRJbml0aWFsT3JkZXIpO3RoaXMuY291bnQ9dGhpcy5vcmRlcjtpZihjaGVja0hlYWRlck1ldGFkYXRhKHRoaXMpfHxjaGVja0hlYWRlck9wdGlvbnModGFibGUsaW5kZXgpKXRoaXMuc29ydERpc2FibGVkPXRydWU7aWYoY2hlY2tIZWFkZXJPcHRpb25zU29ydGluZ0xvY2tlZCh0YWJsZSxpbmRleCkpdGhpcy5vcmRlcj10aGlzLmxvY2tlZE9yZGVyPWNoZWNrSGVhZGVyT3B0aW9uc1NvcnRpbmdMb2NrZWQodGFibGUsaW5kZXgpO2lmKCF0aGlzLnNvcnREaXNhYmxlZCl7dmFyICR0aD0kKHRoaXMpLmFkZENsYXNzKHRhYmxlLmNvbmZpZy5jc3NIZWFkZXIpO2lmKHRhYmxlLmNvbmZpZy5vblJlbmRlckhlYWRlcil0YWJsZS5jb25maWcub25SZW5kZXJIZWFkZXIuYXBwbHkoJHRoKTt9dGFibGUuY29uZmlnLmhlYWRlckxpc3RbaW5kZXhdPXRoaXM7fSk7aWYodGFibGUuY29uZmlnLmRlYnVnKXtiZW5jaG1hcmsoIkJ1aWx0IGhlYWRlcnM6Iix0aW1lKTtsb2coJHRhYmxlSGVhZGVycyk7fXJldHVybiAkdGFibGVIZWFkZXJzO307ZnVuY3Rpb24gY29tcHV0ZVRhYmxlSGVhZGVyQ2VsbEluZGV4ZXModCl7dmFyIG1hdHJpeD1bXTt2YXIgbG9va3VwPXt9O3ZhciB0aGVhZD10LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdUSEVBRCcpWzBdO3ZhciB0cnM9dGhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ1RSJyk7Zm9yKHZhciBpPTA7aTx0cnMubGVuZ3RoO2krKyl7dmFyIGNlbGxzPXRyc1tpXS5jZWxscztmb3IodmFyIGo9MDtqPGNlbGxzLmxlbmd0aDtqKyspe3ZhciBjPWNlbGxzW2pdO3ZhciByb3dJbmRleD1jLnBhcmVudE5vZGUucm93SW5kZXg7dmFyIGNlbGxJZD1yb3dJbmRleCsiLSIrYy5jZWxsSW5kZXg7dmFyIHJvd1NwYW49Yy5yb3dTcGFufHwxO3ZhciBjb2xTcGFuPWMuY29sU3Bhbnx8MTt2YXIgZmlyc3RBdmFpbENvbDtpZih0eXBlb2YobWF0cml4W3Jvd0luZGV4XSk9PSJ1bmRlZmluZWQiKXttYXRyaXhbcm93SW5kZXhdPVtdO31mb3IodmFyIGs9MDtrPG1hdHJpeFtyb3dJbmRleF0ubGVuZ3RoKzE7aysrKXtpZih0eXBlb2YobWF0cml4W3Jvd0luZGV4XVtrXSk9PSJ1bmRlZmluZWQiKXtmaXJzdEF2YWlsQ29sPWs7YnJlYWs7fX1sb29rdXBbY2VsbElkXT1maXJzdEF2YWlsQ29sO2Zvcih2YXIgaz1yb3dJbmRleDtrPHJvd0luZGV4K3Jvd1NwYW47aysrKXtpZih0eXBlb2YobWF0cml4W2tdKT09InVuZGVmaW5lZCIpe21hdHJpeFtrXT1bXTt9dmFyIG1hdHJpeHJvdz1tYXRyaXhba107Zm9yKHZhciBsPWZpcnN0QXZhaWxDb2w7bDxmaXJzdEF2YWlsQ29sK2NvbFNwYW47bCsrKXttYXRyaXhyb3dbbF09IngiO319fX1yZXR1cm4gbG9va3VwO31mdW5jdGlvbiBjaGVja0NlbGxDb2xTcGFuKHRhYmxlLHJvd3Mscm93KXt2YXIgYXJyPVtdLHI9dGFibGUudEhlYWQucm93cyxjPXJbcm93XS5jZWxscztmb3IodmFyIGk9MDtpPGMubGVuZ3RoO2krKyl7dmFyIGNlbGw9Y1tpXTtpZihjZWxsLmNvbFNwYW4+MSl7YXJyPWFyci5jb25jYXQoY2hlY2tDZWxsQ29sU3Bhbih0YWJsZSxoZWFkZXJBcnIscm93KyspKTt9ZWxzZXtpZih0YWJsZS50SGVhZC5sZW5ndGg9PTF8fChjZWxsLnJvd1NwYW4+MXx8IXJbcm93KzFdKSl7YXJyLnB1c2goY2VsbCk7fX19cmV0dXJuIGFycjt9O2Z1bmN0aW9uIGNoZWNrSGVhZGVyTWV0YWRhdGEoY2VsbCl7aWYoKCQubWV0YWRhdGEpJiYoJChjZWxsKS5tZXRhZGF0YSgpLnNvcnRlcj09PWZhbHNlKSl7cmV0dXJuIHRydWU7fTtyZXR1cm4gZmFsc2U7fWZ1bmN0aW9uIGNoZWNrSGVhZGVyT3B0aW9ucyh0YWJsZSxpKXtpZigodGFibGUuY29uZmlnLmhlYWRlcnNbaV0pJiYodGFibGUuY29uZmlnLmhlYWRlcnNbaV0uc29ydGVyPT09ZmFsc2UpKXtyZXR1cm4gdHJ1ZTt9O3JldHVybiBmYWxzZTt9ZnVuY3Rpb24gY2hlY2tIZWFkZXJPcHRpb25zU29ydGluZ0xvY2tlZCh0YWJsZSxpKXtpZigodGFibGUuY29uZmlnLmhlYWRlcnNbaV0pJiYodGFibGUuY29uZmlnLmhlYWRlcnNbaV0ubG9ja2VkT3JkZXIpKXJldHVybiB0YWJsZS5jb25maWcuaGVhZGVyc1tpXS5sb2NrZWRPcmRlcjtyZXR1cm4gZmFsc2U7fWZ1bmN0aW9uIGFwcGx5V2lkZ2V0KHRhYmxlKXt2YXIgYz10YWJsZS5jb25maWcud2lkZ2V0czt2YXIgbD1jLmxlbmd0aDtmb3IodmFyIGk9MDtpPGw7aSsrKXtnZXRXaWRnZXRCeUlkKGNbaV0pLmZvcm1hdCh0YWJsZSk7fX1mdW5jdGlvbiBnZXRXaWRnZXRCeUlkKG5hbWUpe3ZhciBsPXdpZGdldHMubGVuZ3RoO2Zvcih2YXIgaT0wO2k8bDtpKyspe2lmKHdpZGdldHNbaV0uaWQudG9Mb3dlckNhc2UoKT09bmFtZS50b0xvd2VyQ2FzZSgpKXtyZXR1cm4gd2lkZ2V0c1tpXTt9fX07ZnVuY3Rpb24gZm9ybWF0U29ydGluZ09yZGVyKHYpe2lmKHR5cGVvZih2KSE9Ik51bWJlciIpe3JldHVybih2LnRvTG93ZXJDYXNlKCk9PSJkZXNjIik/MTowO31lbHNle3JldHVybih2PT0xKT8xOjA7fX1mdW5jdGlvbiBpc1ZhbHVlSW5BcnJheSh2LGEpe3ZhciBsPWEubGVuZ3RoO2Zvcih2YXIgaT0wO2k8bDtpKyspe2lmKGFbaV1bMF09PXYpe3JldHVybiB0cnVlO319cmV0dXJuIGZhbHNlO31mdW5jdGlvbiBzZXRIZWFkZXJzQ3NzKHRhYmxlLCRoZWFkZXJzLGxpc3QsY3NzKXskaGVhZGVycy5yZW1vdmVDbGFzcyhjc3NbMF0pLnJlbW92ZUNsYXNzKGNzc1sxXSk7dmFyIGg9W107JGhlYWRlcnMuZWFjaChmdW5jdGlvbihvZmZzZXQpe2lmKCF0aGlzLnNvcnREaXNhYmxlZCl7aFt0aGlzLmNvbHVtbl09JCh0aGlzKTt9fSk7dmFyIGw9bGlzdC5sZW5ndGg7Zm9yKHZhciBpPTA7aTxsO2krKyl7aFtsaXN0W2ldWzBdXS5hZGRDbGFzcyhjc3NbbGlzdFtpXVsxXV0pO319ZnVuY3Rpb24gZml4Q29sdW1uV2lkdGgodGFibGUsJGhlYWRlcnMpe3ZhciBjPXRhYmxlLmNvbmZpZztpZihjLndpZHRoRml4ZWQpe3ZhciBjb2xncm91cD0kKCc8Y29sZ3JvdXA+Jyk7JCgidHI6Zmlyc3QgdGQiLHRhYmxlLnRCb2RpZXNbMF0pLmVhY2goZnVuY3Rpb24oKXtjb2xncm91cC5hcHBlbmQoJCgnPGNvbD4nKS5jc3MoJ3dpZHRoJywkKHRoaXMpLndpZHRoKCkpKTt9KTskKHRhYmxlKS5wcmVwZW5kKGNvbGdyb3VwKTt9O31mdW5jdGlvbiB1cGRhdGVIZWFkZXJTb3J0Q291bnQodGFibGUsc29ydExpc3Qpe3ZhciBjPXRhYmxlLmNvbmZpZyxsPXNvcnRMaXN0Lmxlbmd0aDtmb3IodmFyIGk9MDtpPGw7aSsrKXt2YXIgcz1zb3J0TGlzdFtpXSxvPWMuaGVhZGVyTGlzdFtzWzBdXTtvLmNvdW50PXNbMV07by5jb3VudCsrO319ZnVuY3Rpb24gbXVsdGlzb3J0KHRhYmxlLHNvcnRMaXN0LGNhY2hlKXtpZih0YWJsZS5jb25maWcuZGVidWcpe3ZhciBzb3J0VGltZT1uZXcgRGF0ZSgpO312YXIgZHluYW1pY0V4cD0idmFyIHNvcnRXcmFwcGVyID0gZnVuY3Rpb24oYSxiKSB7IixsPXNvcnRMaXN0Lmxlbmd0aDtmb3IodmFyIGk9MDtpPGw7aSsrKXt2YXIgYz1zb3J0TGlzdFtpXVswXTt2YXIgb3JkZXI9c29ydExpc3RbaV1bMV07dmFyIHM9KHRhYmxlLmNvbmZpZy5wYXJzZXJzW2NdLnR5cGU9PSJ0ZXh0Iik/KChvcmRlcj09MCk/bWFrZVNvcnRGdW5jdGlvbigidGV4dCIsImFzYyIsYyk6bWFrZVNvcnRGdW5jdGlvbigidGV4dCIsImRlc2MiLGMpKTooKG9yZGVyPT0wKT9tYWtlU29ydEZ1bmN0aW9uKCJudW1lcmljIiwiYXNjIixjKTptYWtlU29ydEZ1bmN0aW9uKCJudW1lcmljIiwiZGVzYyIsYykpO3ZhciBlPSJlIitpO2R5bmFtaWNFeHArPSJ2YXIgIitlKyIgPSAiK3M7ZHluYW1pY0V4cCs9ImlmKCIrZSsiKSB7IHJldHVybiAiK2UrIjsgfSAiO2R5bmFtaWNFeHArPSJlbHNlIHsgIjt9dmFyIG9yZ09yZGVyQ29sPWNhY2hlLm5vcm1hbGl6ZWRbMF0ubGVuZ3RoLTE7ZHluYW1pY0V4cCs9InJldHVybiBhWyIrb3JnT3JkZXJDb2wrIl0tYlsiK29yZ09yZGVyQ29sKyJdOyI7Zm9yKHZhciBpPTA7aTxsO2krKyl7ZHluYW1pY0V4cCs9In07ICI7fWR5bmFtaWNFeHArPSJyZXR1cm4gMDsgIjtkeW5hbWljRXhwKz0ifTsgIjtpZih0YWJsZS5jb25maWcuZGVidWcpe2JlbmNobWFyaygiRXZhbGluZyBleHByZXNzaW9uOiIrZHluYW1pY0V4cCxuZXcgRGF0ZSgpKTt9ZXZhbChkeW5hbWljRXhwKTtjYWNoZS5ub3JtYWxpemVkLnNvcnQoc29ydFdyYXBwZXIpO2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7YmVuY2htYXJrKCJTb3J0aW5nIG9uICIrc29ydExpc3QudG9TdHJpbmcoKSsiIGFuZCBkaXIgIitvcmRlcisiIHRpbWU6Iixzb3J0VGltZSk7fXJldHVybiBjYWNoZTt9O2Z1bmN0aW9uIG1ha2VTb3J0RnVuY3Rpb24odHlwZSxkaXJlY3Rpb24saW5kZXgpe3ZhciBhPSJhWyIraW5kZXgrIl0iLGI9ImJbIitpbmRleCsiXSI7aWYodHlwZT09J3RleHQnJiZkaXJlY3Rpb249PSdhc2MnKXtyZXR1cm4iKCIrYSsiID09ICIrYisiID8gMCA6ICgiK2ErIiA9PT0gbnVsbCA/IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSA6ICgiK2IrIiA9PT0gbnVsbCA/IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSA6ICgiK2ErIiA8ICIrYisiKSA/IC0xIDogMSApKSk7Ijt9ZWxzZSBpZih0eXBlPT0ndGV4dCcmJmRpcmVjdGlvbj09J2Rlc2MnKXtyZXR1cm4iKCIrYSsiID09ICIrYisiID8gMCA6ICgiK2ErIiA9PT0gbnVsbCA/IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSA6ICgiK2IrIiA9PT0gbnVsbCA/IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSA6ICgiK2IrIiA8ICIrYSsiKSA/IC0xIDogMSApKSk7Ijt9ZWxzZSBpZih0eXBlPT0nbnVtZXJpYycmJmRpcmVjdGlvbj09J2FzYycpe3JldHVybiIoIithKyIgPT09IG51bGwgJiYgIitiKyIgPT09IG51bGwpID8gMCA6KCIrYSsiID09PSBudWxsID8gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIDogKCIrYisiID09PSBudWxsID8gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZIDogIithKyIgLSAiK2IrIikpOyI7fWVsc2UgaWYodHlwZT09J251bWVyaWMnJiZkaXJlY3Rpb249PSdkZXNjJyl7cmV0dXJuIigiK2ErIiA9PT0gbnVsbCAmJiAiK2IrIiA9PT0gbnVsbCkgPyAwIDooIithKyIgPT09IG51bGwgPyBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgOiAoIitiKyIgPT09IG51bGwgPyBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgOiAiK2IrIiAtICIrYSsiKSk7Ijt9fTtmdW5jdGlvbiBtYWtlU29ydFRleHQoaSl7cmV0dXJuIigoYVsiK2krIl0gPCBiWyIraSsiXSkgPyAtMSA6ICgoYVsiK2krIl0gPiBiWyIraSsiXSkgPyAxIDogMCkpOyI7fTtmdW5jdGlvbiBtYWtlU29ydFRleHREZXNjKGkpe3JldHVybiIoKGJbIitpKyJdIDwgYVsiK2krIl0pID8gLTEgOiAoKGJbIitpKyJdID4gYVsiK2krIl0pID8gMSA6IDApKTsiO307ZnVuY3Rpb24gbWFrZVNvcnROdW1lcmljKGkpe3JldHVybiJhWyIraSsiXS1iWyIraSsiXTsiO307ZnVuY3Rpb24gbWFrZVNvcnROdW1lcmljRGVzYyhpKXtyZXR1cm4iYlsiK2krIl0tYVsiK2krIl07Ijt9O2Z1bmN0aW9uIHNvcnRUZXh0KGEsYil7aWYodGFibGUuY29uZmlnLnNvcnRMb2NhbGVDb21wYXJlKXJldHVybiBhLmxvY2FsZUNvbXBhcmUoYik7cmV0dXJuKChhPGIpPy0xOigoYT5iKT8xOjApKTt9O2Z1bmN0aW9uIHNvcnRUZXh0RGVzYyhhLGIpe2lmKHRhYmxlLmNvbmZpZy5zb3J0TG9jYWxlQ29tcGFyZSlyZXR1cm4gYi5sb2NhbGVDb21wYXJlKGEpO3JldHVybigoYjxhKT8tMTooKGI+YSk/MTowKSk7fTtmdW5jdGlvbiBzb3J0TnVtZXJpYyhhLGIpe3JldHVybiBhLWI7fTtmdW5jdGlvbiBzb3J0TnVtZXJpY0Rlc2MoYSxiKXtyZXR1cm4gYi1hO307ZnVuY3Rpb24gZ2V0Q2FjaGVkU29ydFR5cGUocGFyc2VycyxpKXtyZXR1cm4gcGFyc2Vyc1tpXS50eXBlO307dGhpcy5jb25zdHJ1Y3Q9ZnVuY3Rpb24oc2V0dGluZ3Mpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZighdGhpcy50SGVhZHx8IXRoaXMudEJvZGllcylyZXR1cm47dmFyICR0aGlzLCRkb2N1bWVudCwkaGVhZGVycyxjYWNoZSxjb25maWcsc2hpZnREb3duPTAsc29ydE9yZGVyO3RoaXMuY29uZmlnPXt9O2NvbmZpZz0kLmV4dGVuZCh0aGlzLmNvbmZpZywkLnRhYmxlc29ydGVyLmRlZmF1bHRzLHNldHRpbmdzKTskdGhpcz0kKHRoaXMpOyQuZGF0YSh0aGlzLCJ0YWJsZXNvcnRlciIsY29uZmlnKTskaGVhZGVycz1idWlsZEhlYWRlcnModGhpcyk7dGhpcy5jb25maWcucGFyc2Vycz1idWlsZFBhcnNlckNhY2hlKHRoaXMsJGhlYWRlcnMpO2NhY2hlPWJ1aWxkQ2FjaGUodGhpcyk7dmFyIHNvcnRDU1M9W2NvbmZpZy5jc3NEZXNjLGNvbmZpZy5jc3NBc2NdO2ZpeENvbHVtbldpZHRoKHRoaXMpOyRoZWFkZXJzLmNsaWNrKGZ1bmN0aW9uKGUpe3ZhciB0b3RhbFJvd3M9KCR0aGlzWzBdLnRCb2RpZXNbMF0mJiR0aGlzWzBdLnRCb2RpZXNbMF0ucm93cy5sZW5ndGgpfHwwO2lmKCF0aGlzLnNvcnREaXNhYmxlZCYmdG90YWxSb3dzPjApeyR0aGlzLnRyaWdnZXIoInNvcnRTdGFydCIpO3ZhciAkY2VsbD0kKHRoaXMpO3ZhciBpPXRoaXMuY29sdW1uO3RoaXMub3JkZXI9dGhpcy5jb3VudCsrJTI7aWYodGhpcy5sb2NrZWRPcmRlcil0aGlzLm9yZGVyPXRoaXMubG9ja2VkT3JkZXI7aWYoIWVbY29uZmlnLnNvcnRNdWx0aVNvcnRLZXldKXtjb25maWcuc29ydExpc3Q9W107aWYoY29uZmlnLnNvcnRGb3JjZSE9bnVsbCl7dmFyIGE9Y29uZmlnLnNvcnRGb3JjZTtmb3IodmFyIGo9MDtqPGEubGVuZ3RoO2orKyl7aWYoYVtqXVswXSE9aSl7Y29uZmlnLnNvcnRMaXN0LnB1c2goYVtqXSk7fX19Y29uZmlnLnNvcnRMaXN0LnB1c2goW2ksdGhpcy5vcmRlcl0pO31lbHNle2lmKGlzVmFsdWVJbkFycmF5KGksY29uZmlnLnNvcnRMaXN0KSl7Zm9yKHZhciBqPTA7ajxjb25maWcuc29ydExpc3QubGVuZ3RoO2orKyl7dmFyIHM9Y29uZmlnLnNvcnRMaXN0W2pdLG89Y29uZmlnLmhlYWRlckxpc3Rbc1swXV07aWYoc1swXT09aSl7by5jb3VudD1zWzFdO28uY291bnQrKztzWzFdPW8uY291bnQlMjt9fX1lbHNle2NvbmZpZy5zb3J0TGlzdC5wdXNoKFtpLHRoaXMub3JkZXJdKTt9fTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7c2V0SGVhZGVyc0NzcygkdGhpc1swXSwkaGVhZGVycyxjb25maWcuc29ydExpc3Qsc29ydENTUyk7YXBwZW5kVG9UYWJsZSgkdGhpc1swXSxtdWx0aXNvcnQoJHRoaXNbMF0sY29uZmlnLnNvcnRMaXN0LGNhY2hlKSk7fSwxKTtyZXR1cm4gZmFsc2U7fX0pLm1vdXNlZG93bihmdW5jdGlvbigpe2lmKGNvbmZpZy5jYW5jZWxTZWxlY3Rpb24pe3RoaXMub25zZWxlY3RzdGFydD1mdW5jdGlvbigpe3JldHVybiBmYWxzZX07cmV0dXJuIGZhbHNlO319KTskdGhpcy5iaW5kKCJ1cGRhdGUiLGZ1bmN0aW9uKCl7dmFyIG1lPXRoaXM7c2V0VGltZW91dChmdW5jdGlvbigpe21lLmNvbmZpZy5wYXJzZXJzPWJ1aWxkUGFyc2VyQ2FjaGUobWUsJGhlYWRlcnMpO2NhY2hlPWJ1aWxkQ2FjaGUobWUpO30sMSk7fSkuYmluZCgidXBkYXRlQ2VsbCIsZnVuY3Rpb24oZSxjZWxsKXt2YXIgY29uZmlnPXRoaXMuY29uZmlnO3ZhciBwb3M9WyhjZWxsLnBhcmVudE5vZGUucm93SW5kZXgtMSksY2VsbC5jZWxsSW5kZXhdO2NhY2hlLm5vcm1hbGl6ZWRbcG9zWzBdXVtwb3NbMV1dPWNvbmZpZy5wYXJzZXJzW3Bvc1sxXV0uZm9ybWF0KGdldEVsZW1lbnRUZXh0KGNvbmZpZyxjZWxsKSxjZWxsKTt9KS5iaW5kKCJzb3J0b24iLGZ1bmN0aW9uKGUsbGlzdCl7JCh0aGlzKS50cmlnZ2VyKCJzb3J0U3RhcnQiKTtjb25maWcuc29ydExpc3Q9bGlzdDt2YXIgc29ydExpc3Q9Y29uZmlnLnNvcnRMaXN0O3VwZGF0ZUhlYWRlclNvcnRDb3VudCh0aGlzLHNvcnRMaXN0KTtzZXRIZWFkZXJzQ3NzKHRoaXMsJGhlYWRlcnMsc29ydExpc3Qsc29ydENTUyk7YXBwZW5kVG9UYWJsZSh0aGlzLG11bHRpc29ydCh0aGlzLHNvcnRMaXN0LGNhY2hlKSk7fSkuYmluZCgiYXBwZW5kQ2FjaGUiLGZ1bmN0aW9uKCl7YXBwZW5kVG9UYWJsZSh0aGlzLGNhY2hlKTt9KS5iaW5kKCJhcHBseVdpZGdldElkIixmdW5jdGlvbihlLGlkKXtnZXRXaWRnZXRCeUlkKGlkKS5mb3JtYXQodGhpcyk7fSkuYmluZCgiYXBwbHlXaWRnZXRzIixmdW5jdGlvbigpe2FwcGx5V2lkZ2V0KHRoaXMpO30pO2lmKCQubWV0YWRhdGEmJigkKHRoaXMpLm1ldGFkYXRhKCkmJiQodGhpcykubWV0YWRhdGEoKS5zb3J0bGlzdCkpe2NvbmZpZy5zb3J0TGlzdD0kKHRoaXMpLm1ldGFkYXRhKCkuc29ydGxpc3Q7fWlmKGNvbmZpZy5zb3J0TGlzdC5sZW5ndGg+MCl7JHRoaXMudHJpZ2dlcigic29ydG9uIixbY29uZmlnLnNvcnRMaXN0XSk7fWFwcGx5V2lkZ2V0KHRoaXMpO30pO307dGhpcy5hZGRQYXJzZXI9ZnVuY3Rpb24ocGFyc2VyKXt2YXIgbD1wYXJzZXJzLmxlbmd0aCxhPXRydWU7Zm9yKHZhciBpPTA7aTxsO2krKyl7aWYocGFyc2Vyc1tpXS5pZC50b0xvd2VyQ2FzZSgpPT1wYXJzZXIuaWQudG9Mb3dlckNhc2UoKSl7YT1mYWxzZTt9fWlmKGEpe3BhcnNlcnMucHVzaChwYXJzZXIpO307fTt0aGlzLmFkZFdpZGdldD1mdW5jdGlvbih3aWRnZXQpe3dpZGdldHMucHVzaCh3aWRnZXQpO307dGhpcy5mb3JtYXRGbG9hdD1mdW5jdGlvbihzKXt2YXIgaT1wYXJzZUZsb2F0KHMpO3JldHVybihpc05hTihpKSk/MDppO307dGhpcy5mb3JtYXRJbnQ9ZnVuY3Rpb24ocyl7dmFyIGk9cGFyc2VJbnQocyk7cmV0dXJuKGlzTmFOKGkpKT8wOmk7fTt0aGlzLmlzRGlnaXQ9ZnVuY3Rpb24ocyxjb25maWcpe3JldHVybi9eWy0rXT9cZCokLy50ZXN0KCQudHJpbShzLnJlcGxhY2UoL1ssLiddL2csJycpKSk7fTt0aGlzLmNsZWFyVGFibGVCb2R5PWZ1bmN0aW9uKHRhYmxlKXtpZigkLmJyb3dzZXIubXNpZSl7ZnVuY3Rpb24gZW1wdHkoKXt3aGlsZSh0aGlzLmZpcnN0Q2hpbGQpdGhpcy5yZW1vdmVDaGlsZCh0aGlzLmZpcnN0Q2hpbGQpO31lbXB0eS5hcHBseSh0YWJsZS50Qm9kaWVzWzBdKTt9ZWxzZXt0YWJsZS50Qm9kaWVzWzBdLmlubmVySFRNTD0iIjt9fTt9fSk7JC5mbi5leHRlbmQoe3RhYmxlc29ydGVyOiQudGFibGVzb3J0ZXIuY29uc3RydWN0fSk7dmFyIHRzPSQudGFibGVzb3J0ZXI7dHMuYWRkUGFyc2VyKHtpZDoidGV4dCIsaXM6ZnVuY3Rpb24ocyl7cmV0dXJuIHRydWU7fSxmb3JtYXQ6ZnVuY3Rpb24ocyl7cmV0dXJuICQudHJpbShzLnRvTG9jYWxlTG93ZXJDYXNlKCkpO30sdHlwZToidGV4dCJ9KTt0cy5hZGRQYXJzZXIoe2lkOiJkaWdpdCIsaXM6ZnVuY3Rpb24ocyx0YWJsZSl7dmFyIGM9dGFibGUuY29uZmlnO3JldHVybiAkLnRhYmxlc29ydGVyLmlzRGlnaXQocyxjKTt9LGZvcm1hdDpmdW5jdGlvbihzKXtyZXR1cm4gJC50YWJsZXNvcnRlci5mb3JtYXRGbG9hdChzKTt9LHR5cGU6Im51bWVyaWMifSk7dHMuYWRkUGFyc2VyKHtpZDoiY3VycmVuY3kiLGlzOmZ1bmN0aW9uKHMpe3JldHVybi9eW0IjJGICLD8uXS8udGVzdChzKTt9LGZvcm1hdDpmdW5jdGlvbihzKXtyZXR1cm4gJC50YWJsZXNvcnRlci5mb3JtYXRGbG9hdChzLnJlcGxhY2UobmV3IFJlZ0V4cCgvW0IjJGICLF0vZyksIiIpKTt9LHR5cGU6Im51bWVyaWMifSk7dHMuYWRkUGFyc2VyKHtpZDoiaXBBZGRyZXNzIixpczpmdW5jdGlvbihzKXtyZXR1cm4vXlxkezIsM31bXC5dXGR7MiwzfVtcLl1cZHsyLDN9W1wuXVxkezIsM30kLy50ZXN0KHMpO30sZm9ybWF0OmZ1bmN0aW9uKHMpe3ZhciBhPXMuc3BsaXQoIi4iKSxyPSIiLGw9YS5sZW5ndGg7Zm9yKHZhciBpPTA7aTxsO2krKyl7dmFyIGl0ZW09YVtpXTtpZihpdGVtLmxlbmd0aD09Mil7cis9IjAiK2l0ZW07fWVsc2V7cis9aXRlbTt9fXJldHVybiAkLnRhYmxlc29ydGVyLmZvcm1hdEZsb2F0KHIpO30sdHlwZToibnVtZXJpYyJ9KTt0cy5hZGRQYXJzZXIoe2lkOiJ1cmwiLGlzOmZ1bmN0aW9uKHMpe3JldHVybi9eKGh0dHBzP3xmdHB8ZmlsZSk6XC9cLyQvLnRlc3Qocyk7fSxmb3JtYXQ6ZnVuY3Rpb24ocyl7cmV0dXJuIGpRdWVyeS50cmltKHMucmVwbGFjZShuZXcgUmVnRXhwKC8oaHR0cHM/fGZ0cHxmaWxlKTpcL1wvLyksJycpKTt9LHR5cGU6InRleHQifSk7dHMuYWRkUGFyc2VyKHtpZDoiaXNvRGF0ZSIsaXM6ZnVuY3Rpb24ocyl7cmV0dXJuL15cZHs0fVtcLy1dXGR7MSwyfVtcLy1dXGR7MSwyfSQvLnRlc3Qocyk7fSxmb3JtYXQ6ZnVuY3Rpb24ocyl7cmV0dXJuICQudGFibGVzb3J0ZXIuZm9ybWF0RmxvYXQoKHMhPSIiKT9uZXcgRGF0ZShzLnJlcGxhY2UobmV3IFJlZ0V4cCgvLS9nKSwiLyIpKS5nZXRUaW1lKCk6IjAiKTt9LHR5cGU6Im51bWVyaWMifSk7dHMuYWRkUGFyc2VyKHtpZDoicGVyY2VudCIsaXM6ZnVuY3Rpb24ocyl7cmV0dXJuL1wlJC8udGVzdCgkLnRyaW0ocykpO30sZm9ybWF0OmZ1bmN0aW9uKHMpe3JldHVybiAkLnRhYmxlc29ydGVyLmZvcm1hdEZsb2F0KHMucmVwbGFjZShuZXcgUmVnRXhwKC8lL2cpLCIiKSk7fSx0eXBlOiJudW1lcmljIn0pO3RzLmFkZFBhcnNlcih7aWQ6InVzTG9uZ0RhdGUiLGlzOmZ1bmN0aW9uKHMpe3JldHVybiBzLm1hdGNoKG5ldyBSZWdFeHAoL15bQS1aYS16XXszLDEwfVwuPyBbMC05XXsxLDJ9LCAoWzAtOV17NH18Jz9bMC05XXsyfSkgKChbMC0yXT9bMC05XTpbMC01XVswLTldKXwoWzAtMV0/WzAtOV06WzAtNV1bMC05XVxzKEFNfFBNKSkpJC8pKTt9LGZvcm1hdDpmdW5jdGlvbihzKXtyZXR1cm4gJC50YWJsZXNvcnRlci5mb3JtYXRGbG9hdChuZXcgRGF0ZShzKS5nZXRUaW1lKCkpO30sdHlwZToibnVtZXJpYyJ9KTt0cy5hZGRQYXJzZXIoe2lkOiJzaG9ydERhdGUiLGlzOmZ1bmN0aW9uKHMpe3JldHVybi9cZHsxLDJ9W1wvXC1dXGR7MSwyfVtcL1wtXVxkezIsNH0vLnRlc3Qocyk7fSxmb3JtYXQ6ZnVuY3Rpb24ocyx0YWJsZSl7dmFyIGM9dGFibGUuY29uZmlnO3M9cy5yZXBsYWNlKC9cLS9nLCIvIik7aWYoYy5kYXRlRm9ybWF0PT0idXMiKXtzPXMucmVwbGFjZSgvKFxkezEsMn0pW1wvXC1dKFxkezEsMn0pW1wvXC1dKFxkezR9KS8sIiQzLyQxLyQyIik7fWVsc2UgaWYoYy5kYXRlRm9ybWF0PT0idWsiKXtzPXMucmVwbGFjZSgvKFxkezEsMn0pW1wvXC1dKFxkezEsMn0pW1wvXC1dKFxkezR9KS8sIiQzLyQyLyQxIik7fWVsc2UgaWYoYy5kYXRlRm9ybWF0PT0iZGQvbW0veXkifHxjLmRhdGVGb3JtYXQ9PSJkZC1tbS15eSIpe3M9cy5yZXBsYWNlKC8oXGR7MSwyfSlbXC9cLV0oXGR7MSwyfSlbXC9cLV0oXGR7Mn0pLywiJDEvJDIvJDMiKTt9cmV0dXJuICQudGFibGVzb3J0ZXIuZm9ybWF0RmxvYXQobmV3IERhdGUocykuZ2V0VGltZSgpKTt9LHR5cGU6Im51bWVyaWMifSk7dHMuYWRkUGFyc2VyKHtpZDoidGltZSIsaXM6ZnVuY3Rpb24ocyl7cmV0dXJuL14oKFswLTJdP1swLTldOlswLTVdWzAtOV0pfChbMC0xXT9bMC05XTpbMC01XVswLTldXHMoYW18cG0pKSkkLy50ZXN0KHMpO30sZm9ybWF0OmZ1bmN0aW9uKHMpe3JldHVybiAkLnRhYmxlc29ydGVyLmZvcm1hdEZsb2F0KG5ldyBEYXRlKCIyMDAwLzAxLzAxICIrcykuZ2V0VGltZSgpKTt9LHR5cGU6Im51bWVyaWMifSk7dHMuYWRkUGFyc2VyKHtpZDoibWV0YWRhdGEiLGlzOmZ1bmN0aW9uKHMpe3JldHVybiBmYWxzZTt9LGZvcm1hdDpmdW5jdGlvbihzLHRhYmxlLGNlbGwpe3ZhciBjPXRhYmxlLmNvbmZpZyxwPSghYy5wYXJzZXJNZXRhZGF0YU5hbWUpPydzb3J0VmFsdWUnOmMucGFyc2VyTWV0YWRhdGFOYW1lO3JldHVybiAkKGNlbGwpLm1ldGFkYXRhKClbcF07fSx0eXBlOiJudW1lcmljIn0pO3RzLmFkZFdpZGdldCh7aWQ6InplYnJhIixmb3JtYXQ6ZnVuY3Rpb24odGFibGUpe2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7dmFyIHRpbWU9bmV3IERhdGUoKTt9dmFyICR0cixyb3c9LTEsb2RkOyQoInRyOnZpc2libGUiLHRhYmxlLnRCb2RpZXNbMF0pLmVhY2goZnVuY3Rpb24oaSl7JHRyPSQodGhpcyk7aWYoISR0ci5oYXNDbGFzcyh0YWJsZS5jb25maWcuY3NzQ2hpbGRSb3cpKXJvdysrO29kZD0ocm93JTI9PTApOyR0ci5yZW1vdmVDbGFzcyh0YWJsZS5jb25maWcud2lkZ2V0WmVicmEuY3NzW29kZD8wOjFdKS5hZGRDbGFzcyh0YWJsZS5jb25maWcud2lkZ2V0WmVicmEuY3NzW29kZD8xOjBdKX0pO2lmKHRhYmxlLmNvbmZpZy5kZWJ1Zyl7JC50YWJsZXNvcnRlci5iZW5jaG1hcmsoIkFwcGx5aW5nIFplYnJhIHdpZGdldCIsdGltZSk7fX19KTt9KShqUXVlcnkpOw==]]></data></item>
              <item key="default"></item>
              <item key="id">jquery.tablesorter.min.js</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[jQuery tablesorter plugin: http://tablesorter.com]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">resource</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="default"></item>
              <item key="id">attr_dc_description</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type">attr_dc_description</item>
              <item key="multilang" type="int">1</item>
              <item key="name">DC.Description</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">text</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[## Script (Python) "ZMSTable.widths"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: Col-Widths [list]
##
# --// BO widths //--

REQUEST = zmscontext.REQUEST
table = zmscontext.attr('table')
ncols = max(map(lambda x: len(x), table))
weights = map(lambda x: 1, range( ncols))
for row in table:
    i = 0
    for cell in row:
        weight = len(zmscontext.re_sub('<(.*?)>', '',zmscontext.dt_exec(cell.get('content',''))))
        weights[i] = weights[i] + weight
        i += 1
return map(lambda x: int((x*100.0)/sum(weights)), weights)

# --// EO widths //--
]]>
              </item>
              <item key="default"></item>
              <item key="id">widths</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[Col-Widths [list]]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">py</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[## Script (Python) "ZMSTable.format"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: contentEditable.Cell: Get format (@key)
##
# --// BO format //--

REQUEST = zmscontext.REQUEST
key = REQUEST.get('key')
if key:
    table = zmscontext.attr('table')
    col = int(key[key.find('_')+1:key.rfind('_')])
    row = int(key[key.rfind('_')+1:])
    return table[row][col]['format']
return ''

# --// EO format //--
]]>
              </item>
              <item key="default"></item>
              <item key="id">format</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[contentEditable.Cell: Get format (@key)]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">py</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[## Script (Python) "ZMSTable.setObjProperty"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=zmscontext
##title=py: contentEditable.Cell: Set property (@pKey,@pValue)
##
# --// BO setObjProperty //--

REQUEST = zmscontext.REQUEST
key = REQUEST.get('pKey')
value = REQUEST.get('pValue')
if key.startswith('table_'):
    table = zmscontext.attr('table')
    col = int(key[key.find('_')+1:key.rfind('_')])
    row = int(key[key.rfind('_')+1:])
    table[row][col]['content'] = value
    lang = REQUEST.get('lang')
    zmscontext.setObjProperty('table',table_table,lang)

# --// EO setObjProperty //--
]]>
              </item>
              <item key="default"></item>
              <item key="id">setObjProperty</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[contentEditable.Cell: Set property (@pKey,@pValue)]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">py</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[@media screen and (max-width:560px){.uzk15__editorblock caption{ display:block;}}]]></item>
              <item key="default"></item>
              <item key="id">zmstable_css</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name">CSS</item>
              <item key="repetitive" type="int">0</item>
              <item key="type">zpt</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[<tal:block tal:define="zmscontext options/zmscontext; cols python:zmscontext.attr('cols'); d python:{}">
    <tal:block tal:repeat="col python:zmscontext.attr('widths')">
        <tal:block tal:define="col_index repeat/col/index">
            <tal:block tal:condition="python:col_index<len(cols) and cols[col_index]">
                <tal:block tal:define="dummy0 python:zmscontext.operator_setitem(d,col_index+1,str(cols[col_index])+'%')"></tal:block>
            </tal:block>
        </tal:block>
    </tal:block>
    <tal:block tal:condition="python:len(d)>0">
        @media screen and (min-width:560px){
            <tal:block tal:repeat="k d">
                table#<tal:block tal:content="python:zmscontext.id"></tal:block> tr th:nth-child(<tal:block tal:content="k"></tal:block>), table#<tal:block tal:content="python:zmscontext.id"></tal:block> tr td:nth-child(<tal:block tal:content="k"></tal:block>) { width:<tal:block tal:content="python:d[k]"></tal:block> }</tal:block>
        }
    </tal:block>
</tal:block>]]>
              </item>
              <item key="default"></item>
              <item key="id">zmstable_colgroup_css</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[CSS Colgroup]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">zpt</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[table.ZMSTable.sortable thead tr .header{background-image:  url('data:image/gif;base64,R0lGODlhGQALAMIEAO/v7/b29v39/f7+/v///////////////yH5BAEKAAcALAAAAAAZAAsAAAMkeLqs0DA2MYK8jGiNLxkb1zVhOZ6oUoapGoLtYsZLMAh083QJADs=');background-repeat: no-repeat;background-position: center right;cursor: pointer;}table.ZMSTable.sortable thead tr .headerSortUp{background-image: url( data:image/gif;base64,R0lGODlhGQAFAMIEAO/v7/b29v39/f7+/v///////////////yH5BAEKAAcALAAAAAAZAAUAAAMUeLpK/o/J2eAgNDOItT/BIHwkQCYAOw==);}table.ZMSTable.sortable thead tr .headerSortDown {background-image:  url('data:image/gif;base64,R0lGODlhGQAFAMIEAO/v7/b29v39/f7+/v///////////////yH5BAEKAAcALAAAAAAZAAUAAAMUeLp80DA2MYK8jGiNLxkb1zVheSUAOw==');}]]></item>
              <item key="default"></item>
              <item key="id">zmstable_sortable_css</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[CSS Sortable]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">zpt</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[<tal:block tal:define="global zmscontext options/zmscontext; resourceurl python:'%s/%s.'%(zmscontext.metaobj_manager.absolute_url(),zmscontext.meta_id);">
  $(function(){
    $.plugin('tablesorter',{
      files: ['<tal:block tal:content="resourceurl"></tal:block>jquery.tablesorter.min.js']
    });
    $.plugin('tablesorter').get('.ZMSTable.sortable',function() {
      $(".ZMSTable.sortable").tablesorter();
    });
  });
</tal:block>]]>
              </item>
              <item key="default"></item>
              <item key="id">zmstable_sortable_js</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[JS Sortable]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">zpt</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[fas fa-table]]></item>
              <item key="default"></item>
              <item key="id">icon_clazz</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[Icon (CSS)]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">constant</item>
            </dictionary>
          </item>
          <item type="dictionary">
            <dictionary>
              <item key="custom"><![CDATA[<div tal:define="zmscontext    options/zmscontext;
                 Std           modules/Products.PythonScripts/standard; 
                 newline_to_br nocall:Std/newline_to_br;
                 rteformats    python:filter(lambda x: str(x.getRichedit())=='1',here.getTextFormats(request)); 
                 table         python:zmscontext.attr('table');
                 sortable      python:int(zmscontext.attr('sortable') in [1,True]);
                 caption       python:zmscontext.attr('caption');
                 table_type    python:zmscontext.attr('type');"
     class="uzk15__editorblock">
    <tal:block tal:condition="python:request.get('ZMSTable.standard_html',True)">
        <style tal:define="dummy0 python:request.set('ZMSTable.standard_html',False)" tal:content="structure python:zmscontext.attr('zmstable_css')"></style>
    </tal:block>
    <tal:block tal:condition="python:sortable and request.get('ZMSTable.sortable',True)">
        <script tal:define="dummy0 python:request.set('ZMSTable.sortable',False)" tal:content="structure python:zmscontext.attr('zmstable_sortable_js')"></script>
        <style tal:content="structure python:zmscontext.attr('zmstable_sortable_css')"></style>
    </tal:block>
    <style tal:condition="python:zmscontext.attr('colgroup')" tal:content="structure python:zmscontext.attr('zmstable_colgroup_css')"></style>
    <table tal:attributes="id python:zmscontext.id; class python:' '.join(['ZMSTable table bs-table']+[[],['sortable']][sortable])">
        <caption tal:condition="python:caption" tal:content="structure caption"></caption>
        <tal:block tal:repeat="row table">
            <tal:block tal:condition="python:table_type==1 and row==table[0]" tal:content="structure python:'<thead>'"></tal:block>
            <tal:block tal:condition="python:table_type==1 and row==table[1]" tal:content="structure python:'<tbody>'"></tal:block>
            <tr>
                <tal:block tal:repeat="column row">
                    <tal:block tal:define="row_index     repeat/row/index;
                                           col_index     repeat/column/index;
                                           tag           python:str(column.get('tag','')).lower();
                                           format        python:column.get('format','');
                                           pattern       python:'%3Cdtml-var%20\042 getlinkurl\\((.*?),request\\)\042=\042\042>\042>\073';
                                           replacement   python:'<dtml-var \042getLinkUrl(\\1,REQUEST)\042>\042>';
                                           content       python:zmscontext.re_sub(pattern,replacement,column.get('content',''));
                                           content       python:[content,newline_to_br(content)][format==''];
                                           col_text      python:[zmscontext.dt_exec(zmscontext.renderText(format,'table_%i_%i'%(col_index,row_index),content,request)),content][format in map(lambda x: x.getId(),rteformats)];
                                           col_text      python:zmscontext.re_sub('^(B \073)','',col_text);
                                           col_text      python:zmscontext.re_sub('^<p>((\\w|\\W)*?)</p>$','\\1',col_text)">
                        <th tal:condition="python:tag == 'th'" tal:content="structure python:col_text if col_text else ' '"></th>
                        <td tal:condition="python:tag != 'th'" tal:content="structure python:col_text if col_text else ' '"></td>
                    </tal:block>
                </tal:block>
            </tr>
            <tal:block tal:condition="python:table_type==1 and row==table[0]" tal:content="structure python:'</thead>'"></tal:block>
            <tal:block tal:condition="python:table_type==1 and row==table[-1]" tal:content="structure python:'</tbody>'"></tal:block>
        </tal:block>
    </table>
</div>
<div class="uzk15__height40"></div>]]>
              </item>
              <item key="default"></item>
              <item key="id">standard_html</item>
              <item key="keys" type="list">
                <list>
                </list>
              </item>
              <item key="mandatory" type="int">0</item>
              <item key="meta_type"></item>
              <item key="multilang" type="int">0</item>
              <item key="name"><![CDATA[Template: ZMSTable]]></item>
              <item key="repetitive" type="int">0</item>
              <item key="type">zpt</item>
            </dictionary>
          </item>
        </list>
      </item>
      <item key="access" type="dictionary">
        <dictionary>
          <item key="delete_custom"></item>
          <item key="delete_deny" type="list">
            <list>
              <item></item>
              <item></item>
              <item></item>
            </list>
          </item>
          <item key="insert_custom">{$}</item>
          <item key="insert_deny" type="list">
            <list>
              <item></item>
              <item></item>
              <item></item>
            </list>
          </item>
        </dictionary>
      </item>
      <item key="enabled" type="int">1</item>
      <item key="id">ZMSTable</item>
      <item key="name">ZMSTable</item>
      <item key="package">com.zms.foundation</item>
      <item key="revision">4.0.0</item>
      <item key="type">ZMSObject</item>
    </dictionary>
  </item>
</dictionary>